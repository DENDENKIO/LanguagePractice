<UserControl x:Class="LanguagePractice.Views.MindsetLabSessionView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1000">

    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto"/>
            <RowDefinition Height="*"/>
            <RowDefinition Height="Auto"/>
        </Grid.RowDefinitions>

        <!-- ヘッダー -->
        <Border Grid.Row="0" Background="#1565C0" Padding="15">
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Button Grid.Column="0" Content="← 戻る" Command="{Binding BackCommand}"
                        Background="Transparent" Foreground="White" BorderThickness="0"
                        FontSize="14" Cursor="Hand" Padding="10,5"/>

                <StackPanel Grid.Column="1" HorizontalAlignment="Center">
                    <TextBlock Text="🧠 MindsetLab セッション" FontSize="18" FontWeight="Bold" Foreground="White" HorizontalAlignment="Center"/>
                    <TextBlock Text="{Binding Day.DateKey}" FontSize="12" Foreground="#BBDEFB" HorizontalAlignment="Center"/>
                </StackPanel>

                <TextBlock Grid.Column="2" Text="{Binding StatusMessage}" Foreground="#BBDEFB" 
                           VerticalAlignment="Center" Margin="10,0" FontSize="12" MaxWidth="300" TextTrimming="CharacterEllipsis"/>
            </Grid>
        </Border>

        <!-- メインコンテンツ -->
        <Grid Grid.Row="1">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="400"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- 左パネル：AIミッション生成 -->
            <Border Grid.Column="0" Background="#F5F5F5" Padding="15">
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel>
                        <TextBlock Text="📋 今日のミッション" FontSize="14" FontWeight="Bold" Margin="0,0,0,10"/>

                        <!-- ミッション生成ボタン（未生成時） -->
                        <Border Background="White" Padding="15" CornerRadius="4" Margin="0,0,0,10"
                                Visibility="{Binding IsPlanGenerated, Converter={StaticResource InverseBoolToVisibilityConverter}}">
                            <StackPanel>
                                <TextBlock Text="AIがあなたの今日の訓練ミッションを生成します。" 
                                           TextWrapping="Wrap" Foreground="#616161" Margin="0,0,0,15"/>

                                <Button Content="🤖 AIでミッション自動生成" 
                                        Command="{Binding GeneratePlanAutoCommand}"
                                        Padding="12,10" FontSize="14"
                                        Background="#2196F3" Foreground="White" BorderThickness="0"
                                        IsEnabled="{Binding IsGenerating, Converter={StaticResource InverseBoolConverter}}"/>

                                <TextBlock Text="または" HorizontalAlignment="Center" Margin="0,10" Foreground="#757575"/>

                                <Button Content="📝 手動モードで生成" 
                                        Command="{Binding SwitchToManualCommand}"
                                        Padding="10,8"/>
                            </StackPanel>
                        </Border>

                        <!-- 手動モード入力エリア -->
                        <Border Background="White" Padding="10" CornerRadius="4" Margin="0,0,0,10"
                                Visibility="{Binding IsManualMode, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <TextBlock Text="【手動モード】" FontWeight="Bold" Foreground="#FF9800" Margin="0,0,0,10"/>

                                <TextBlock Text="プロンプト:" FontSize="12" Margin="0,0,0,5"/>
                                <TextBox Text="{Binding PlanPrompt}" 
                                         Height="100"
                                         TextWrapping="Wrap" AcceptsReturn="True"
                                         VerticalScrollBarVisibility="Auto"
                                         IsReadOnly="True" Background="#FAFAFA" FontSize="11"/>

                                <Button Content="📋 プロンプトをコピー" Command="{Binding CopyPromptCommand}"
                                        Padding="8,5" Margin="0,5,0,0"/>

                                <TextBlock Text="AI出力を貼り付け:" FontSize="12" Margin="0,10,0,5"/>
                                <TextBox Text="{Binding PlanOutput, UpdateSourceTrigger=PropertyChanged}" 
                                         Height="120"
                                         TextWrapping="Wrap" AcceptsReturn="True"
                                         VerticalScrollBarVisibility="Auto"/>

                                <Button Content="✅ ミッション適用" Command="{Binding ApplyPlanCommand}"
                                        Padding="10,8" Margin="0,10,0,0"
                                        Background="#4CAF50" Foreground="White" BorderThickness="0"/>
                            </StackPanel>
                        </Border>

                        <!-- 今日のミッション表示（生成済み） -->
                        <Border Background="White" Padding="15" CornerRadius="4"
                                Visibility="{Binding IsPlanGenerated, Converter={StaticResource BoolToVisibilityConverter}}">
                            <StackPanel>
                                <TextBlock Text="✨ 今日のミッション" FontWeight="Bold" Foreground="#1565C0" FontSize="14" Margin="0,0,0,15"/>

                                <!-- 重点マインドセット -->
                                <Border Background="#E8F5E9" Padding="10" CornerRadius="4" Margin="0,0,0,10">
                                    <StackPanel>
                                        <TextBlock Text="🎯 重点マインドセット" FontWeight="Bold" FontSize="12" Foreground="#2E7D32"/>
                                        <TextBlock Text="{Binding FocusMindsetDisplay}" TextWrapping="Wrap" Margin="0,5,0,0"/>
                                    </StackPanel>
                                </Border>

                                <!-- シーン設定 -->
                                <Border Background="#E3F2FD" Padding="10" CornerRadius="4" Margin="0,0,0,10"
                                        Visibility="{Binding HasScene, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="🎬 今日のシーン" FontWeight="Bold" FontSize="12" Foreground="#1565C0"/>
                                        <TextBlock Text="{Binding Scene}" TextWrapping="Wrap" Margin="0,5,0,0" 
                                                   FontStyle="Italic" LineHeight="20"/>
                                    </StackPanel>
                                </Border>

                                <!-- タスク -->
                                <Border Background="#FFFDE7" Padding="10" CornerRadius="4" Margin="0,0,0,10"
                                        Visibility="{Binding HasTasks, Converter={StaticResource BoolToVisibilityConverter}}">
                                    <StackPanel>
                                        <TextBlock Text="📝 タスク" FontWeight="Bold" FontSize="12" Foreground="#F57F17" Margin="0,0,0,5"/>
                                        <ItemsControl ItemsSource="{Binding TodayTasks}">
                                            <ItemsControl.ItemTemplate>
                                                <DataTemplate>
                                                    <TextBlock Margin="5,3" TextWrapping="Wrap" LineHeight="20">
                                                        <Run Text="• "/>
                                                        <Run Text="{Binding Mode=OneWay}"/>
                                                    </TextBlock>
                                                </DataTemplate>
                                            </ItemsControl.ItemTemplate>
                                        </ItemsControl>
                                    </StackPanel>
                                </Border>

                                <!-- 再生成ボタン -->
                                <Button Content="🔄 ミッションを再生成" 
                                        Command="{Binding GeneratePlanAutoCommand}"
                                        Padding="10,8" Margin="0,15,0,0"
                                        IsEnabled="{Binding IsGenerating, Converter={StaticResource InverseBoolConverter}}"/>
                            </StackPanel>
                        </Border>
                    </StackPanel>
                </ScrollViewer>
            </Border>

            <!-- 右パネル：ドリル入力 -->
            <Border Grid.Column="1" Padding="15">
                <Grid>
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto"/>
                        <RowDefinition Height="*"/>
                    </Grid.RowDefinitions>

                    <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="0,0,0,10">
                        <TextBlock Text="📝 ドリル入力" FontSize="14" FontWeight="Bold" VerticalAlignment="Center"/>
                        <TextBlock Text="（シーンをイメージしながら記入してください）" FontSize="12" 
                                   Foreground="#757575" Margin="10,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <ScrollViewer Grid.Row="1" VerticalScrollBarVisibility="Auto">
                        <ItemsControl ItemsSource="{Binding DrillInputs}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="White" Margin="0,0,0,10" Padding="15" CornerRadius="4"
                                            BorderBrush="#E0E0E0" BorderThickness="1">
                                        <StackPanel>
                                            <StackPanel Orientation="Horizontal">
                                                <TextBlock Text="{Binding DisplayHeader}" FontWeight="Bold" FontSize="13"/>
                                                <TextBlock Text="{Binding DisplayHint}" Foreground="#757575" FontSize="12" Margin="5,0,0,0"/>
                                            </StackPanel>
                                            <TextBlock Text="{Binding MindsetName}" FontSize="11" Foreground="#1565C0" Margin="0,2,0,5"/>
                                            <TextBox Text="{Binding BodyText, UpdateSourceTrigger=PropertyChanged}" 
                                                     MinHeight="60" MaxHeight="150"
                                                     TextWrapping="Wrap" AcceptsReturn="True"
                                                     VerticalScrollBarVisibility="Auto"
                                                     Padding="8"/>
                                        </StackPanel>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </ScrollViewer>
                </Grid>
            </Border>
        </Grid>

        <!-- フッター -->
        <Border Grid.Row="2" Background="#F5F5F5" Padding="15">
            <Grid>
                <StackPanel Orientation="Horizontal" HorizontalAlignment="Left">
                    <Button Content="🏠 ホームへ" Command="{Binding BackCommand}"
                            Padding="12,8" Margin="0,0,10,0"/>
                    <Button Content="📊 履歴を見る" Command="{Binding ViewHistoryCommand}"
                            Padding="12,8"/>
                </StackPanel>

                <StackPanel Orientation="Horizontal" HorizontalAlignment="Right">
                    <Button Content="💾 一時保存" Command="{Binding SaveAllCommand}"
                            Padding="15,10" Margin="0,0,10,0"/>
                    <Button Content="📊 レビューへ進む →" Command="{Binding GoToReviewCommand}"
                            Padding="15,10"
                            Background="#4CAF50" Foreground="White" BorderThickness="0" FontWeight="Bold"/>
                </StackPanel>
            </Grid>
        </Border>
    </Grid>
</UserControl>
